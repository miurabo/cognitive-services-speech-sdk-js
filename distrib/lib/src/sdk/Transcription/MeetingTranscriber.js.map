{"version":3,"sources":["src/sdk/Transcription/MeetingTranscriber.ts"],"names":[],"mappings":"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","file":"MeetingTranscriber.js","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\n// Licensed under the MIT license.\n\nimport { TranscriberRecognizer } from \"../../common.speech/Exports\";\nimport { marshalPromiseToCallbacks } from \"../../common/Exports\";\nimport { Contracts } from \"../Contracts\";\nimport {\n    AudioConfig,\n    CancellationEventArgs,\n    Connection,\n    MeetingTranscriptionEventArgs,\n    PropertyCollection,\n    PropertyId,\n    SessionEventArgs\n} from \"../Exports\";\nimport {\n    MeetingHandler,\n    MeetingImpl,\n    MeetingTranscriptionHandler\n} from \"./Exports\";\nimport { Callback, IMeeting } from \"./IMeeting\";\n\nexport class MeetingTranscriber implements MeetingTranscriptionHandler {\n\n    /**\n     * The event canceled signals that an error occurred during the meeting.\n     * @member MeetingTranscriber.prototype.MeetingCanceled\n     * @function\n     * @public\n     */\n    public MeetingCanceled: (sender: MeetingHandler, event: CancellationEventArgs) => void;\n\n    /**\n     * The event canceled signals that an error occurred during transcription.\n     * @member MeetingTranscriber.prototype.canceled\n     * @function\n     * @public\n     */\n    public canceled: (sender: MeetingHandler, event: CancellationEventArgs) => void;\n\n     /**\n      * The event recognized signals that a final meeting transcription result is received.\n      * @member MeetingTranscriber.prototype.transcribed\n      * @function\n      * @public\n      */\n    public transcribed: (sender: MeetingTranscriptionHandler, event: MeetingTranscriptionEventArgs) => void;\n\n     /**\n      * The event recognizing signals that an intermediate meeting transcription result is received.\n      * @member MeetingTranscriber.prototype.transcribing\n      * @function\n      * @public\n      */\n    public transcribing: (sender: MeetingTranscriptionHandler, event: MeetingTranscriptionEventArgs) => void;\n\n    /**\n     * Defines event handler for session started events.\n     * @member MeetingTranscriber.prototype.sessionStarted\n     * @function\n     * @public\n     */\n    public sessionStarted: (sender: MeetingHandler, event: SessionEventArgs) => void;\n\n    /**\n     * Defines event handler for session stopped events.\n     * @member MeetingTranscriber.prototype.sessionStopped\n     * @function\n     * @public\n     */\n    public sessionStopped: (sender: MeetingHandler, event: SessionEventArgs) => void;\n\n    /**\n     * Defines event handler for meeting started events.\n     * @member MeetingTranscriber.prototype.MeetingStarted\n     * @function\n     * @public\n     */\n    public MeetingStarted: (sender: MeetingHandler, event: SessionEventArgs) => void;\n\n    /**\n     * Defines event handler for meeting stopped events.\n     * @member MeetingTranscriber.prototype.MeetingStopped\n     * @function\n     * @public\n     */\n    public meetingStopped: (sender: MeetingHandler, event: SessionEventArgs) => void;\n\n    protected privAudioConfig: AudioConfig;\n    private privDisposedRecognizer: boolean;\n    private privRecognizer: TranscriberRecognizer;\n    private privProperties: PropertyCollection;\n\n    /**\n     * MeetingTranscriber constructor.\n     * @constructor\n     * @param {AudioConfig} audioConfig - An optional audio configuration associated with the recognizer\n     */\n    public constructor(audioConfig?: AudioConfig) {\n        this.privAudioConfig = audioConfig;\n        this.privProperties = new PropertyCollection();\n        this.privRecognizer = undefined;\n        this.privDisposedRecognizer = false;\n    }\n\n    /**\n     * Gets the spoken language of recognition.\n     * @member MeetingTranscriber.prototype.speechRecognitionLanguage\n     * @function\n     * @public\n     * @returns {string} The spoken language of recognition.\n     */\n    public get speechRecognitionLanguage(): string {\n        Contracts.throwIfDisposed(this.privDisposedRecognizer);\n\n        return this.properties.getProperty(PropertyId.SpeechServiceConnection_RecoLanguage);\n    }\n\n    /**\n     * The collection of properties and their values defined for this MeetingTranscriber.\n     * @member MeetingTranscriber.prototype.properties\n     * @function\n     * @public\n     * @returns {PropertyCollection} The collection of properties and their values defined for this MeetingTranscriber.\n     */\n    public get properties(): PropertyCollection {\n        return this.privProperties;\n    }\n\n    /**\n     * @Internal\n     * Internal data member to support fromRecognizer* pattern methods on other classes.\n     * Do not use externally, object returned will change without warning or notice.\n     */\n    public get internalData(): object {\n        return this.privRecognizer.internalData;\n    }\n\n    /**\n     * @Deprecated\n     * @Obsolete\n     * Please use the Connection.fromRecognizer pattern to obtain a connection object\n     */\n    public get connection(): Connection {\n        return Connection.fromRecognizer(this.privRecognizer);\n    }\n\n    /**\n     * Gets the authorization token used to communicate with the service.\n     * @member MeetingTranscriber.prototype.authorizationToken\n     * @function\n     * @public\n     * @returns {string} Authorization token.\n     */\n    public get authorizationToken(): string {\n        return this.properties.getProperty(PropertyId.SpeechServiceAuthorization_Token);\n    }\n\n    /**\n     * Gets/Sets the authorization token used to communicate with the service.\n     * @member MeetingTranscriber.prototype.authorizationToken\n     * @function\n     * @public\n     * @param {string} token - Authorization token.\n     */\n    public set authorizationToken(token: string) {\n        Contracts.throwIfNullOrWhitespace(token, \"token\");\n        this.properties.setProperty(PropertyId.SpeechServiceAuthorization_Token, token);\n    }\n\n    /**\n     * @param {Meeting} meeting - meeting to be recognized\n     */\n    public joinMeetingAsync(meeting: IMeeting, cb?: Callback, err?: Callback): void {\n        /* eslint-disable no-console */\n        // console.log(\">> MeetingTranscriber::joinMeetingAsync\");\n        /* eslint-enable no-console */\n        const meetingImpl = meeting as MeetingImpl;\n        Contracts.throwIfNullOrUndefined(MeetingImpl, \"Meeting\");\n\n        // ref the meeting object\n        // create recognizer and subscribe to recognizer events\n        this.privRecognizer = new TranscriberRecognizer(meeting.config, this.privAudioConfig);\n        Contracts.throwIfNullOrUndefined(this.privRecognizer, \"Recognizer\");\n        this.privRecognizer.connectMeetingCallbacks(this);\n\n        marshalPromiseToCallbacks(meetingImpl.connectTranscriberRecognizer(this.privRecognizer), cb, err);\n    }\n\n    /**\n     * Starts meeting transcription, until stopTranscribingAsync() is called.\n     * User must subscribe to events to receive transcription results.\n     * @member MeetingTranscriber.prototype.startTranscribingAsync\n     * @function\n     * @public\n     * @param cb - Callback invoked once the transcription has started.\n     * @param err - Callback invoked in case of an error.\n     */\n    public startTranscribingAsync(cb?: Callback, err?: Callback): void {\n        this.privRecognizer.startContinuousRecognitionAsync(cb, err);\n    }\n\n    /**\n     * Starts meeting transcription, until stopTranscribingAsync() is called.\n     * User must subscribe to events to receive transcription results.\n     * @member MeetingTranscriber.prototype.stopTranscribingAsync\n     * @function\n     * @public\n     * @param cb - Callback invoked once the transcription has started.\n     * @param err - Callback invoked in case of an error.\n     */\n    public stopTranscribingAsync(cb?: Callback, err?: Callback): void {\n        this.privRecognizer.stopContinuousRecognitionAsync(cb, err);\n    }\n\n    /**\n     * Leave the current meeting. After this is called, you will no longer receive any events.\n     */\n    public leaveMeetingAsync(cb?: Callback, err?: Callback): void {\n        this.privRecognizer.disconnectCallbacks();\n        // eslint-disable-next-line\n        marshalPromiseToCallbacks((async (): Promise<void> => { return; })(), cb, err);\n    }\n\n    /**\n     * closes all external resources held by an instance of this class.\n     * @member MeetingTranscriber.prototype.close\n     * @function\n     * @public\n     */\n    public close(cb?: () => void, errorCb?: (error: string) => void): void {\n        Contracts.throwIfDisposed(this.privDisposedRecognizer);\n        marshalPromiseToCallbacks(this.dispose(true), cb, errorCb);\n    }\n\n    /**\n     * Disposes any resources held by the object.\n     * @member MeetingTranscriber.prototype.dispose\n     * @function\n     * @public\n     * @param {boolean} disposing - true if disposing the object.\n     */\n    protected async dispose(disposing: boolean): Promise<void> {\n        if (this.privDisposedRecognizer) {\n            return;\n        }\n        if (!!this.privRecognizer) {\n            await this.privRecognizer.close();\n            this.privRecognizer = undefined;\n        }\n        if (disposing) {\n            this.privDisposedRecognizer = true;\n        }\n    }\n}\n"]}